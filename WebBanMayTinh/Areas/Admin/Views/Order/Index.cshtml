@model PagedList.IPagedList<WebBanMayTinh.Models.Order>
@using PagedList.Mvc;

@{
    ViewBag.Title = "Index";
    Layout = "~/Areas/Admin/Views/Shared/_AdminLayout.cshtml";
}

<h2>Quản lí đơn hàng</h2>

<style>

    .table > :not(caption) > * > * {
        padding: 0.7rem 1.5rem;
        background-color: var(--bs-table-bg);
        border-bottom-width: 1px;
        box-shadow: inset 0 0 0 9999px var(--bs-table-accent-bg);
    }
</style>
<style>
    * {
        margin: 0;
        padding: 0;
        font-size: 16px;
        box-sizing: border-box;
    }

    a {
        text-decoration: none;
    }

    .Box_Button_Add {
        justify-content: space-between;
        flex-direction: row-reverse;
    }

        .Box_Button_Add .Btn_AddProduct {
            border-radius: 25px;
            border: 2px solid #37a1a8;
        }

    .Btn_AddProduct > p {
        position: relative;
        top: 9px;
        left: 2px;
    }

    .Form_Search .search-bar {
        display: flex;
        justify-content: space-evenly;
        padding: 20px 0px;
    }

    .search-bar .searchterm {
    }

    .searchterm > input {
        width: 300px;
    }

    .form-group .btn-finding {
        background-color: bisque;
        margin-left: 15px;
    }

    .SortBar {
        margin: 20px 0px;
    }

        .SortBar .container-fluid {
            width: 93%;
        }

        .SortBar .Sort_Function {
            display: flex;
            justify-content: space-between;
        }

    .Sort_Function .Sort {
        border-radius: 25px;
        border: 2px solid #37a1a8;
        width: 162px;
        text-align: center;
    }

    .pagination-container {
    }

        .pagination-container .pagination {
            padding-left: 12px;
        }

    .pagination > li {
        margin-right: 12px;
    }

        .pagination > li > a {
            border-radius: 9px;
            border: 2px solid #73AD21;
            padding: 9px;
            font-size: 16px;
            font-weight: 600;
            line-height: 1.6;
        }
</style>


@if (Model != null && Model.Any())
{

    <div class="container_fluid">

        <table class="table">
            <tr>
                <th>
                    #
                </th>

                <th class="col-2">
                    Tên khách hàng
                </th>

                <th class="col-2">
                    Trạng thái
                </th>


                <th class="col-2">
                    Tổng tiền
                </th>


                <th class="col-1">
                    Ngày đặt
                </th>


                <th class="col-5" style="text-align:center">
                    Chức năng

                </th>
            </tr>

            @foreach (var item in Model)
            {
                <tr>
                    <td>
                        @item.OrderID
                    </td>

                    <td>
                        @item.Customer.CustomerName
                    </td>

                    <td>
                        <a href="#" class="btn btn-sm btn-success btnTrangThai" data-id="@item.OrderID">@item.PaymentStatus</a>
                    </td>

                    <td>
                        @item.TotalAmount
                    </td>

                    <td>
                        @item.OrderDate.ToString("mm/dd/yyyy")
                    </td>

                    <td style="text-align:center">
                        @Html.ActionLink("Chi tiết", "View", new { id = item.OrderID })
                        @*@Html.ActionLink("Xóa", "Delete", new { id = item.OrderID }) *@
                    </td>
                </tr>
            }
        </table>
        @Html.PagedListPager(Model, Page => Url.Action("Index", new { Page, }))
    </div>
}
else
{
    <div class="Error_Finding">
        Đơn hàng rỗng
    </div>
}
<div class="modal fade" id="modal-default" style="display:none;" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h4 class="modal-title">Cập nhật trạng thái</h4>
                <button type="button" class="close btnDong" data-dismiss="modal" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div class="modal-body">
                <input type="hidden" id="txtOrderID" value="0" />
                <div class="form-group">
                    <label>Trạng thái</label>
                    <select class="form-control" id="ddTrangThai">
                        <option value="0">Chưa thanh toán</option>
                        <option value="1">Đang vận chuyển</option>
                        <option value="2">Hoàn thành</option>
                    </select>
                </div>
            </div>
            <div class="modal-footer justify-content-between">
                <button type="button" class="btn btn-default btnDong" data-dismiss="modal">Đóng</button>
                <button type="button" class="btn btn-primary" id="btnLuu">Lưu</button>
            </div>
        </div>
    </div>
</div>
@section scripts{
    <script>
        $(document).ready(function () {
            $('body').on('click', '.btnTrangThai', function () {
                var id = $(this).data("id");
                $('#txtOrderID').val(id);
                $('#modal-default').modal('show')
            });

            $('body').on('click', '.btnDong', function () {
                $('#modal-default').modal('hide')
            });

            $('body').on('click', '#btnLuu', function () {
                var id = $('#txtOrderID').val();
                var tt = $('#ddTrangThai').val();
                $.ajax({
                    Url: '/Admin/Order/UpdateTT',
                    type: 'POST',
                    data: { id: id, trangthai: tt },
                    success: function (res) {
                        if (res.Success) {
                            location.reload();
                        }
                    }

                });
            });
        });

    </script>
}



